[menu/motd]
parent: "generic/menu"
text: """
Pythelix
"""

{enter(client)}
client.location = !menu/username!

[menu/username]
parent: "generic/menu"
text: """
Enter your username or 'new' to create a new one.
"""

{unknown_input(client, input)}
account = search.one(!account!, username=input.strip().lower())
if account:
    client.account = account
    client.location = !menu/password!
else:
    client.msg(f"The username {input} doesn't exist. Want to create one? Enter NEW.")
endif

[command/username/new]
parent: "generic/command"
location: "menu/username"
name: "new"

{run(client)}
client.location = !menu/new/username!

[menu/password]
parent: "generic/menu"
text: """
Enter the password for this account.
"""

{input(client, input)}
account = client.account
if account.password.verify(input):
    character = account.character
    client.msg("Good.")
    client.owner = account.character
    client.controls.add(account.character)
    client.location = !menu/game!
else:
    client.location = !menu/invalid/password!
endif

[menu/invalid/password]
parent: "generic/menu"
text: """
Invalid password. Waiting...
"""

{enter(client)}
log("Before wait")
wait 3
log("After wait")
client.location = !menu/password!

{unknown_input(client, _input)}
client.msg("Wait a bit...")

[menu/new/username]
parent: "generic/menu"
text: """
Welcome! Enter your new username.
"""

{input(client, input)}
account = search.one(!account!, username=input.lower())
if account:
    client.msg("This account already exists. Try a new one.")
else:
    account = Entity(parent=!account!)
    account.username = input.lower()
    client.account = account
    client.location = !menu/new/password!
endif

[menu/new/password]
parent: "generic/menu"
text: """
Great! Enter your new password.
"""

{input(client, input=2)}
client.account.password = password.hash(input)
client.msg("Awesome!")
character = Entity(parent=!generic/character!)
client.location = !menu/username!
character.game_modes.add("menu/game", character.id)
client.account.character = character

[menu/game]
parent: "generic/menu"
text: """
And that's pythelix!
"""

{get_prompt(_client)}
return "HP: 200"

[menu/pythello]
parent: "generic/menu"
text: """
Welcome to the Pythello scripting console
You can enter Pythello scripting instructions and see the result in your console.
Enter 'quit' to quit this console.
Use '>' followed by a command to enter a command in the normal game mode (like '>look').
"""
prompt: ">>>"

{unknown_input(character, input)}
character.msg(f"Received: {input}.")

[command/pythello/quit]
parent: "generic/command"
location: "menu/pythello"
name: "quit"

{run(character)}
character.game_modes.remove(0)
character.msg("Good bye.")
